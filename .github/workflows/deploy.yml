name: ğŸš€ CI/CD Deploy ke Server (Self-Hosted)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy on Local Server
    runs-on: self-hosted

    steps:
      - name: ğŸ›  Fix ownership before pulling
        run: |
          sudo chown -R devsrvdb1:devsrvdb1 /var/www/html/testcicd

      - name: ğŸ” Pull latest code
        run: |
          cd /var/www/html/testcicd
          git pull origin main

      - name: ğŸ” Set permissions for web server
        run: |
          sudo chown -R www-data:www-data /var/www/html/testcicd
          sudo find /var/www/html/testcicd -type f -exec chmod 644 {} \;
          sudo find /var/www/html/testcicd -type d -exec chmod 755 {} \;

      - name: âœ… Done
        run: echo "Deploy sukses!"
